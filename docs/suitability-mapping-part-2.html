<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Suitability Mapping: Part 2 | IRDR0047: Geospatial Data Science (2023/24)</title>
  <meta name="description" content="IRDR0047: Geospatial Data Science" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Suitability Mapping: Part 2 | IRDR0047: Geospatial Data Science (2023/24)" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="IRDR0047: Geospatial Data Science" />
  <meta name="github-repo" content="UCLPG-MSC-SGDS/IRDR0047" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Suitability Mapping: Part 2 | IRDR0047: Geospatial Data Science (2023/24)" />
  
  <meta name="twitter:description" content="IRDR0047: Geospatial Data Science" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installation-of-r-and-rstudio.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/module-catalogue/modules/geospatial-data-science-IRDR0047"><img src="images/general/ucl_logo.png">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contacts-details"><i class="fa fa-check"></i>Contacts details</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="installation-of-r-and-rstudio.html"><a href="installation-of-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Installation of R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installation-of-r-and-rstudio.html"><a href="installation-of-r-and-rstudio.html#what-is-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> What is R and RStudio?</a></li>
<li class="chapter" data-level="1.2" data-path="installation-of-r-and-rstudio.html"><a href="installation-of-r-and-rstudio.html#downloading-and-install-r-and-rstudio-on-to-your-laptop"><i class="fa fa-check"></i><b>1.2</b> Downloading and install R and RStudio on to your laptop</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="installation-of-r-and-rstudio.html"><a href="installation-of-r-and-rstudio.html#installation-for-macos-users"><i class="fa fa-check"></i><b>1.2.1</b> Installation for MacOS users</a></li>
<li class="chapter" data-level="1.2.2" data-path="installation-of-r-and-rstudio.html"><a href="installation-of-r-and-rstudio.html#installation-for-windows-users"><i class="fa fa-check"></i><b>1.2.2</b> Installation for Windows users</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html"><i class="fa fa-check"></i><b>2</b> Suitability Mapping: Part 2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#lecture-video-length-010642"><i class="fa fa-check"></i><b>2.1.1</b> Lecture video (Length: 01:06:42)</a></li>
<li class="chapter" data-level="2.1.2" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#computer-practical-video-length-020001"><i class="fa fa-check"></i><b>2.1.2</b> Computer practical video (Length 02:00:01)</a></li>
<li class="chapter" data-level="2.1.3" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#learning-outcomes"><i class="fa fa-check"></i><b>2.1.3</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.1.4" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#datasets-setting-up-the-work-directory"><i class="fa fa-check"></i><b>2.1.4</b> Datasets &amp; setting up the work directory</a></li>
<li class="chapter" data-level="2.1.5" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#loading-and-installing-packages"><i class="fa fa-check"></i><b>2.1.5</b> Loading and installing packages</a></li>
<li class="chapter" data-level="2.1.6" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#loading-datasets"><i class="fa fa-check"></i><b>2.1.6</b> Loading datasets</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#data-preparation-for-the-maxent-analysis"><i class="fa fa-check"></i><b>2.2</b> Data preparation for the MAXENT analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#creating-a-multi-band-raster-using-the-stack-function"><i class="fa fa-check"></i><b>2.2.1</b> Creating a multi-band raster using the stack() function</a></li>
<li class="chapter" data-level="2.2.2" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#preparing-data-for-pseudo-background-points-as-absence"><i class="fa fa-check"></i><b>2.2.2</b> Preparing data for pseudo-background points as absence</a></li>
<li class="chapter" data-level="2.2.3" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#extraction-of-all-raster-values-from-predictor-variables-onto-presence-absence-points"><i class="fa fa-check"></i><b>2.2.3</b> Extraction of all raster values from predictor variables onto presence-absence points</a></li>
<li class="chapter" data-level="2.2.4" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#preparation-of-training-test-data-for-prediction-model-cross-validation"><i class="fa fa-check"></i><b>2.2.4</b> Preparation of training &amp; test data for prediction &amp; model cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#maxent-analysis"><i class="fa fa-check"></i><b>2.3</b> MAXENT Analysis</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#examination-of-the-predictors-contribution-and-response-curves"><i class="fa fa-check"></i><b>2.3.1</b> Examination of the predictor’s contribution and response curves</a></li>
<li class="chapter" data-level="2.3.2" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#model-validation"><i class="fa fa-check"></i><b>2.3.2</b> Model validation</a></li>
<li class="chapter" data-level="2.3.3" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#mapping-the-predicted-probability-and-suitability"><i class="fa fa-check"></i><b>2.3.3</b> Mapping the predicted probability and suitability</a></li>
<li class="chapter" data-level="2.3.4" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#supplementary-code-for-4-fold-analysis"><i class="fa fa-check"></i><b>2.3.4</b> Supplementary code for 4-fold analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#attributions"><i class="fa fa-check"></i><b>2.4</b> Attributions</a></li>
<li class="chapter" data-level="2.5" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#references-see-reading-list"><i class="fa fa-check"></i><b>2.5</b> References (see reading list)</a></li>
<li class="chapter" data-level="2.6" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#data-sources"><i class="fa fa-check"></i><b>2.6</b> Data Sources</a></li>
<li class="chapter" data-level="2.7" data-path="suitability-mapping-part-2.html"><a href="suitability-mapping-part-2.html#practical-homework"><i class="fa fa-check"></i><b>2.7</b> Practical homework</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">IRDR0047: Geospatial Data Science (2023/24)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="suitability-mapping-part-2" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Suitability Mapping: Part 2<a href="suitability-mapping-part-2.html#suitability-mapping-part-2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction<a href="suitability-mapping-part-2.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="lecture-video-length-010642" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Lecture video (Length: 01:06:42)<a href="suitability-mapping-part-2.html#lecture-video-length-010642" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/uAakkG-l-r0" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/uAakkG-l-r0">[<strong>Watch on YouTube</strong>]</a></p>
</div>
<div id="computer-practical-video-length-020001" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Computer practical video (Length 02:00:01)<a href="suitability-mapping-part-2.html#computer-practical-video-length-020001" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="vembedr" align="center">
<div>
<iframe src="https://www.youtube.com/embed/C_aGyS5Cmos" width="711" height="400" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
<p><a href="https://youtu.be/C_aGyS5Cmos">[<strong>Watch on YouTube</strong>]</a></p>
<p>Last week, we described how knowledge-driven methods informed by expert opinion (often drawn from experience or literature) can be used to predict locations that are suitable (or favourable) for a specific outcome given a set of environmental factors, which in turn, can be outputted as a thematic raster map. Last week’s approach uses a mixed (i.e., qualitative and quantitative) methodology through the use of <strong>Overlay Mapping</strong> and <strong>Analytical Hierarchy Process (AHP)</strong> for suitability mapping, and these approaches are used strictly when there are no point occurrence data.</p>
<p>This week, we are using distributional niche models, often term as either: <strong>Ecological (or Environmental) Niche Models</strong>, or <strong>Environmental or Habitat Suitability Models</strong>. These are quantitative methods that use occurrence data in conjunction with environmental data to make a correlative model of the environmental conditions that meet an outcome’s environmental (or ecological) requirements, which in turn, can predict the relative suitability of habitat for that outcome. It has many applications in ecology, epidemiology, disaster risk reduction and social sciences (e.g., crime patterns). Today, we are going to use the <strong>Maximum Entropy Model (MAXENT)</strong> to infer zones for disaster hazards such as wildfires in California given a set of predictor variables (i.e, climate, vegetation, anthropogenic and socioeconomic risk factors which are raster).</p>
</div>
<div id="learning-outcomes" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Learning outcomes<a href="suitability-mapping-part-2.html#learning-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to learn the following steps:</p>
<ol style="list-style-type: decimal">
<li>Handling of point locations of occurrence data (i.e., points of fires) and preparing it as testing and training data;</li>
<li>Handling of predictor variables (i.e., raster) and compiling them into a raster stack object, as well as perform extraction of raster values to the points of fire locations;</li>
<li>Generating a Niche model using the <code>maxent()</code> from points, and use the stacked raster values to fit a model to estimate probability (or trigger points) of a fire hazard;</li>
<li>Testing for model validation using ROC and AUC curves, and producing a surface based on threshold to delineate regions for suitability (in context probable trigger points for wildfires).</li>
</ol>
</div>
<div id="datasets-setting-up-the-work-directory" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Datasets &amp; setting up the work directory<a href="suitability-mapping-part-2.html#datasets-setting-up-the-work-directory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before you begin do make sure to download all data by <a href="https://github.com/UCLPG-MSC-SGDS/GEOG0114/raw/main/Week%205%20-%20Dataset.zip"><strong>clicking here</strong></a>. Create a folder on called “<strong>Week 5</strong>” within your “<strong>GEOG0114</strong>” folder stored in the desktop of your personal computer. Make sure to extract all data from the zip folder and store it into “<strong>Week 5</strong>” folder. Open a new R script and set the work directory to <strong>Week 5’s</strong> folder.</p>
<p>For Windows, the work directory will be:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="suitability-mapping-part-2.html#cb2-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/AccountName/Desktop/GEOG0114/Week 5&quot;</span>)</span></code></pre></div>
<p>For MAC, the work directory will be:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="suitability-mapping-part-2.html#cb3-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;/Users/AccountName/Desktop/GEOG0114/Week 5&quot;</span>)</span></code></pre></div>
</div>
<div id="loading-and-installing-packages" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Loading and installing packages<a href="suitability-mapping-part-2.html#loading-and-installing-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="warning">
<p>IMPORTANT NOTE: We will need to install <strong>Java</strong> for the <code>rjava</code> package as well as the <code>maxent()</code> function and other functions associated with performing MAXENT to work. You can download the latest version of Java <a href="https://www.java.com/en/download/"><strong>[HERE]</strong></a></p>
</div>
<p>Next, we will need to load the following packages:</p>
<ul>
<li><code>raster</code>: Raster/gridded data analysis and manipulation</li>
<li><code>sf</code>: Simple Features</li>
<li><code>sp</code>: Package for providing classes for spatial data (points, lines, polygons and grids)</li>
<li><code>spdep</code>: Access to spatial functions such <code>spsample()</code> needed for generating background points</li>
<li><code>tmap</code>: Thematic Mapping</li>
</ul>
<p>The above packages <code>raster</code> <code>sf</code>, <code>sp</code>, <code>spdep</code> &amp; <code>tmap</code> should have been installed in the previous session(s). We will need to install the following new package(s):</p>
<ul>
<li><code>dismo</code>: Provides access to methods for niches distribution modelling in RStudio.</li>
<li><code>rJava</code>: Low-level interface for Java. The <code>maxent()</code> function depends on this so it must be installed.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="suitability-mapping-part-2.html#cb4-1" tabindex="-1"></a><span class="co"># Install the packages with install.package():</span></span>
<span id="cb4-2"><a href="suitability-mapping-part-2.html#cb4-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dismo&quot;</span>)</span>
<span id="cb4-3"><a href="suitability-mapping-part-2.html#cb4-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rJava&quot;</span>)</span>
<span id="cb4-4"><a href="suitability-mapping-part-2.html#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="suitability-mapping-part-2.html#cb4-5" tabindex="-1"></a><span class="co"># Load the packages with library():</span></span>
<span id="cb4-6"><a href="suitability-mapping-part-2.html#cb4-6" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;raster&quot;</span>)</span>
<span id="cb4-7"><a href="suitability-mapping-part-2.html#cb4-7" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dismo&quot;</span>)</span>
<span id="cb4-8"><a href="suitability-mapping-part-2.html#cb4-8" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tmap&quot;</span>)</span>
<span id="cb4-9"><a href="suitability-mapping-part-2.html#cb4-9" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb4-10"><a href="suitability-mapping-part-2.html#cb4-10" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;rJava&quot;</span>)</span>
<span id="cb4-11"><a href="suitability-mapping-part-2.html#cb4-11" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;spdep&quot;</span>)</span></code></pre></div>
</div>
<div id="loading-datasets" class="section level3 hasAnchor" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Loading datasets<a href="suitability-mapping-part-2.html#loading-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be dealing with both point occurrence and raster data for this exercise. The point data are remote-sensed fire detection locations across the State of California during the summer period of 2018. We will be using predictor variables that are climatic (i.e., temperature, precipitation, dryness), environmental (vegetation and elevation) and other social-anthropogenic (socioeconomic deprivation) gridded raster data for California.</p>
<p>We will combine them into a <strong>MAXENT</strong> model in order to quantify the areas that are potential trigger points for wildfires, and whether these variables greatly influencing the risk of a fire hazard.</p>
<p>Let us begin loading the following list of raster files, each is a variable of interest:</p>
<ul>
<li>Raster: Temperature named <code>California_temperature_summer_2018.tif</code></li>
<li>Raster: Precipitation named <code>California_precipitation_summer_2018.tif</code></li>
<li>Raster: Dryness named <code>California_dryness_summer_2018.tif</code></li>
<li>Raster: Vegetation (NDVI) named <code>California_vegetation_summer_2018.tif</code></li>
<li>Raster: Elevation named <code>California_elevation_summer_2018.tif</code></li>
<li>Raster: Deprivation Index named <code>California_socdeprivation_summer_2018.tif</code></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="suitability-mapping-part-2.html#cb5-1" tabindex="-1"></a><span class="co"># load data raster data</span></span>
<span id="cb5-2"><a href="suitability-mapping-part-2.html#cb5-2" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_temperature_summer_2018.tif&quot;</span>)</span>
<span id="cb5-3"><a href="suitability-mapping-part-2.html#cb5-3" tabindex="-1"></a>prec <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_precipitation_summer_2018.tif&quot;</span>)</span>
<span id="cb5-4"><a href="suitability-mapping-part-2.html#cb5-4" tabindex="-1"></a>dryn <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_dryness_summer_2018.tif&quot;</span>)</span>
<span id="cb5-5"><a href="suitability-mapping-part-2.html#cb5-5" tabindex="-1"></a>ndvi <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_vegetation_summer_2018.tif&quot;</span>)</span>
<span id="cb5-6"><a href="suitability-mapping-part-2.html#cb5-6" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_elevation_summer_2018.tif&quot;</span>)</span>
<span id="cb5-7"><a href="suitability-mapping-part-2.html#cb5-7" tabindex="-1"></a>sevi <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;California_socdeprivation_summer_2018.tif&quot;</span>)</span></code></pre></div>
<p>Load the boundary and county shapefile for California:</p>
<ul>
<li>Shape file: California’s boundary border named <code>.shp</code></li>
<li>Shape file: California’s County borders named <code>.shp</code></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="suitability-mapping-part-2.html#cb6-1" tabindex="-1"></a><span class="co"># load shapefile data for california</span></span>
<span id="cb6-2"><a href="suitability-mapping-part-2.html#cb6-2" tabindex="-1"></a>california_border <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;California_boundary.shp&quot;</span>)</span>
<span id="cb6-3"><a href="suitability-mapping-part-2.html#cb6-3" tabindex="-1"></a>california_county <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;California_county.shp&quot;</span>)</span></code></pre></div>
<p>Load the point occurrence data for California:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="suitability-mapping-part-2.html#cb7-1" tabindex="-1"></a><span class="co"># load occurrence fire data in California</span></span>
<span id="cb7-2"><a href="suitability-mapping-part-2.html#cb7-2" tabindex="-1"></a>california_fires <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;California_Fire_Summer_2018.csv&quot;</span>)</span></code></pre></div>
<div class="note">
<p><strong>IMPORTANT NOTES</strong>: All shape file and raster data (5km resolution) were projected to the CRS: WGS84 4236.</p>
</div>
<p>The occurrence data imported into RStudio is a data frame object. We will need to first convert the occurrence data from data frame to a spatial points object by declaring columns <code>longitude</code> and <code>latitude</code> corresponds to <code>x</code> and <code>y</code> respectively and thus coordinates in data frame object <code>california_fires</code></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="suitability-mapping-part-2.html#cb8-1" tabindex="-1"></a><span class="co"># code chunk format coordinates(data.frame) = ~x+y</span></span>
<span id="cb8-2"><a href="suitability-mapping-part-2.html#cb8-2" tabindex="-1"></a><span class="fu">coordinates</span>(california_fires) <span class="ot">=</span> <span class="er">~</span>longitude<span class="sc">+</span>latitude</span></code></pre></div>
<p>Now, we need to define its coordinate reference system for the points which should be the same as any of the raster data. You can get this information by simple typing the raster object to console and printing its info there:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="suitability-mapping-part-2.html#cb9-1" tabindex="-1"></a><span class="co"># show details of temp as example</span></span>
<span id="cb9-2"><a href="suitability-mapping-part-2.html#cb9-2" tabindex="-1"></a>temp</span></code></pre></div>
<p>We need to copy the detail under the <code>crs</code> section of out <code>temp</code> output and assign that detail to our points so as it also has a CRS of <code>WGS84 4326</code>. We can use the <code>crs()</code> function to perform this action. Now copy: <code>+proj=longlat +datum=WGS84 +no_defs</code> and use the following code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="suitability-mapping-part-2.html#cb10-1" tabindex="-1"></a><span class="fu">crs</span>(california_fires) <span class="ot">&lt;-</span> <span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs&quot;</span></span></code></pre></div>
<p>Let us visualise the study area to examine the spatial distribution of wildfires.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="suitability-mapping-part-2.html#cb11-1" tabindex="-1"></a><span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(california_fires) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="images/general/week5/image1_studyarea.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Let us visualise the six predictor raster variables that will be used for the Niche modelling with MAXENT. Instead of visual each output individually - you can use <code>tmap_arrange()</code> to create a figure panel for the six images.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="suitability-mapping-part-2.html#cb12-1" tabindex="-1"></a><span class="co"># map object of temperature stored in m1</span></span>
<span id="cb12-2"><a href="suitability-mapping-part-2.html#cb12-2" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(temp) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Celsius&quot;</span>, <span class="at">palette=</span> <span class="st">&quot;Oranges&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="suitability-mapping-part-2.html#cb12-3" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="suitability-mapping-part-2.html#cb12-4" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;A&quot;</span>)</span>
<span id="cb12-5"><a href="suitability-mapping-part-2.html#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="suitability-mapping-part-2.html#cb12-6" tabindex="-1"></a><span class="co"># map object of precipitation stored in m2</span></span>
<span id="cb12-7"><a href="suitability-mapping-part-2.html#cb12-7" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(prec) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;mm&quot;</span>, <span class="at">palette=</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="suitability-mapping-part-2.html#cb12-8" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="suitability-mapping-part-2.html#cb12-9" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;B&quot;</span>)</span>
<span id="cb12-10"><a href="suitability-mapping-part-2.html#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="suitability-mapping-part-2.html#cb12-11" tabindex="-1"></a><span class="co"># map object of dryness stored in m3</span></span>
<span id="cb12-12"><a href="suitability-mapping-part-2.html#cb12-12" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(dryn) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;mm/0.25yr&quot;</span>, <span class="at">palette=</span> <span class="st">&quot;-Spectral&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="suitability-mapping-part-2.html#cb12-13" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="suitability-mapping-part-2.html#cb12-14" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;C&quot;</span>)</span>
<span id="cb12-15"><a href="suitability-mapping-part-2.html#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="suitability-mapping-part-2.html#cb12-16" tabindex="-1"></a><span class="co"># map object of ndvi stored in m4</span></span>
<span id="cb12-17"><a href="suitability-mapping-part-2.html#cb12-17" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ndvi) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Index&quot;</span>, <span class="at">palette=</span> <span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="suitability-mapping-part-2.html#cb12-18" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-19"><a href="suitability-mapping-part-2.html#cb12-19" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;D&quot;</span>)</span>
<span id="cb12-20"><a href="suitability-mapping-part-2.html#cb12-20" tabindex="-1"></a></span>
<span id="cb12-21"><a href="suitability-mapping-part-2.html#cb12-21" tabindex="-1"></a><span class="co"># map object of elevation stored in m5</span></span>
<span id="cb12-22"><a href="suitability-mapping-part-2.html#cb12-22" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(elev) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;m&quot;</span>, <span class="at">midpoint =</span> <span class="dv">1500</span>, <span class="at">palette=</span> <span class="st">&quot;-Spectral&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-23"><a href="suitability-mapping-part-2.html#cb12-23" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-24"><a href="suitability-mapping-part-2.html#cb12-24" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;E&quot;</span>)</span>
<span id="cb12-25"><a href="suitability-mapping-part-2.html#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="suitability-mapping-part-2.html#cb12-26" tabindex="-1"></a><span class="co"># map object of sevi stored in m6</span></span>
<span id="cb12-27"><a href="suitability-mapping-part-2.html#cb12-27" tabindex="-1"></a>m6 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(sevi) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="at">title =</span> <span class="st">&quot;%&quot;</span>, <span class="at">palette=</span> <span class="st">&quot;Reds&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-28"><a href="suitability-mapping-part-2.html#cb12-28" tabindex="-1"></a>            <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-29"><a href="suitability-mapping-part-2.html#cb12-29" tabindex="-1"></a>            <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;top&quot;</span>), <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title =</span> <span class="st">&quot;F&quot;</span>)</span>
<span id="cb12-30"><a href="suitability-mapping-part-2.html#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="suitability-mapping-part-2.html#cb12-31" tabindex="-1"></a><span class="co"># stitch the maps together using tmap_arrange() function</span></span>
<span id="cb12-32"><a href="suitability-mapping-part-2.html#cb12-32" tabindex="-1"></a><span class="fu">tmap_arrange</span>(m1, m2, m3, m4, m5, m6, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="images/general/week5/image2_environmental_variables.png" width="100%" style="display: block; margin: auto;" />
A: Temperature (degree Celsius); B: Precipitation (mm); C: Dryness (Evapotranspiration) (mm/0.25 year); D: Vegetation (NDVI); E: Elevation (meters [m]); &amp; F: Socioeconomic vulnerability index (%)</p>
<div class="note">
<p><strong>IMPORTANT NOTES</strong>: It is good practice to produce figure outputs of the study area of interest inside the methodology section of an essay, report, dissertation, research paper etc.,. This gives you the opportunity to describe the study area that is under investigation and variables in the methods section.</p>
</div>
</div>
</div>
<div id="data-preparation-for-the-maxent-analysis" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Data preparation for the MAXENT analysis<a href="suitability-mapping-part-2.html#data-preparation-for-the-maxent-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="creating-a-multi-band-raster-using-the-stack-function" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Creating a multi-band raster using the stack() function<a href="suitability-mapping-part-2.html#creating-a-multi-band-raster-using-the-stack-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Basically, a band is represented by a single matrix of cell values, and a raster with multiple bands contains multiple spatially coincident matrices of cell values representing the same spatial area. For example, the raster object for <code>temp</code> (i.e., temperature) is a <strong>single band raster object</strong>. But, if we start to stack raster objects <code>prec</code>, <code>dryn</code>, <code>ndvi</code> and so on top of <code>temp</code>, one over the other, then we have created a <strong>multi-band raster object</strong>.</p>
<p>We need to create this <strong>multi-band raster object</strong> to enable the following action needed for the analysis:</p>
<ol style="list-style-type: decimal">
<li>To perform the extraction of raster values from all 6 variables on to the occurrence points in one go;</li>
<li>The entire multi-band raster object is needed for MAXENT estimation and spatial prediction</li>
</ol>
<p>We use the <code>stack()</code> to stack all raster grids into one object and rename the layers within the multi-band object to names that are tenable.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="suitability-mapping-part-2.html#cb13-1" tabindex="-1"></a>envCovariates <span class="ot">&lt;-</span> <span class="fu">stack</span>(temp, prec, dryn, ndvi, elev, sevi)</span>
<span id="cb13-2"><a href="suitability-mapping-part-2.html#cb13-2" tabindex="-1"></a><span class="fu">names</span>(envCovariates) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Temperature&quot;</span>, <span class="st">&quot;Precipitation&quot;</span>, <span class="st">&quot;Dryness&quot;</span>, <span class="st">&quot;NDVI&quot;</span>, <span class="st">&quot;Elevation&quot;</span>, <span class="st">&quot;Deprivation&quot;</span>)</span></code></pre></div>
</div>
<div id="preparing-data-for-pseudo-background-points-as-absence" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Preparing data for pseudo-background points as absence<a href="suitability-mapping-part-2.html#preparing-data-for-pseudo-background-points-as-absence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to prepare the background data. What is the background data? With Background data we are not attempting to guess point locations where an event is absent. Here, we are rather trying to characterise the environment of the study region. In this sense, background is the same, irrespective of where the point fire are found or not. Background data establishes the environmental domain of the study, whilst presence data should establish under which conditions a fire is more likely to be present than on average.</p>
<p>In essence, we are creating a set of control points which we act as pseudo-absence. These are typically generated at random. There are several ways of performing this action using other functions such as <code>randomPoints()</code>, <code>sampleRandom</code> and many more.</p>
<p>We are using the <code>spsample()</code> function because it allows the user to specify the boundary for which the background points (i.e., controls) should be randomly generated within. Twice the number of occurrence points are generated (the choice of twice is up to the user). For reproducibility in the random generation, we have set the <code>set.seed()</code> function to this <code>20000430</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="suitability-mapping-part-2.html#cb14-1" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb14-2"><a href="suitability-mapping-part-2.html#cb14-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20000430</span>)</span>
<span id="cb14-3"><a href="suitability-mapping-part-2.html#cb14-3" tabindex="-1"></a><span class="co"># we need to coerce &#39;sf&#39; object california_border into &#39;sp&#39; object for spsample to work</span></span>
<span id="cb14-4"><a href="suitability-mapping-part-2.html#cb14-4" tabindex="-1"></a>california_border_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(california_border, <span class="at">Class =</span> <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb14-5"><a href="suitability-mapping-part-2.html#cb14-5" tabindex="-1"></a><span class="co"># here, spsample() generates twice number of fire occurrence points randomly within California&#39;s border</span></span>
<span id="cb14-6"><a href="suitability-mapping-part-2.html#cb14-6" tabindex="-1"></a>background_points <span class="ot">&lt;-</span> <span class="fu">spsample</span>(california_border_sp, <span class="at">n=</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(california_fires), <span class="st">&quot;random&quot;</span>)</span></code></pre></div>
</div>
<div id="extraction-of-all-raster-values-from-predictor-variables-onto-presence-absence-points" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Extraction of all raster values from predictor variables onto presence-absence points<a href="suitability-mapping-part-2.html#extraction-of-all-raster-values-from-predictor-variables-onto-presence-absence-points" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we are going to extract information from our <code>envCovariates</code> raster stack to both the presence and background points. This can be done using the <code>extract()</code> function.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="suitability-mapping-part-2.html#cb15-1" tabindex="-1"></a><span class="co"># perform raster extraction from the environmental covariates on to points</span></span>
<span id="cb15-2"><a href="suitability-mapping-part-2.html#cb15-2" tabindex="-1"></a>california_fires_env <span class="ot">&lt;-</span> <span class="fu">extract</span>(envCovariates, california_fires)</span>
<span id="cb15-3"><a href="suitability-mapping-part-2.html#cb15-3" tabindex="-1"></a>background_points_env <span class="ot">&lt;-</span> <span class="fu">extract</span>(envCovariates, background_points)</span></code></pre></div>
<div class="note">
<p><strong>IMPORTANT NOTES</strong>: After the extraction, the objects <code>california_fires_env</code> and <code>background_points_env</code> exist as a large matrix, and not as a data frame.</p>
</div>
<p>For all occurrence points (i.e., presence), we need to add an indicator of <code>1</code> to signify presence; while for all background points (i.e., absence) - we need to also add an indicator of <code>0</code> to signify absence. We do this because we are modelling a probability and such niche models take outcomes that are from a <a href="https://simple.wikipedia.org/wiki/Bernoulli_distribution"><strong>Bernoulli</strong></a> or <a href="https://simple.wikipedia.org/wiki/Binomial_distribution"><strong>Binomial distribution</strong></a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="suitability-mapping-part-2.html#cb16-1" tabindex="-1"></a><span class="co"># convert large matrix objects to data frame objects and add outcome `fire` indicator</span></span>
<span id="cb16-2"><a href="suitability-mapping-part-2.html#cb16-2" tabindex="-1"></a>california_fires_env <span class="ot">&lt;-</span><span class="fu">data.frame</span>(california_fires_env,<span class="at">fire=</span><span class="dv">1</span>)</span>
<span id="cb16-3"><a href="suitability-mapping-part-2.html#cb16-3" tabindex="-1"></a>background_points_env <span class="ot">&lt;-</span><span class="fu">data.frame</span>(background_points_env,<span class="at">fire=</span><span class="dv">0</span>)</span>
<span id="cb16-4"><a href="suitability-mapping-part-2.html#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="suitability-mapping-part-2.html#cb16-5" tabindex="-1"></a><span class="co"># View one of the data frame</span></span>
<span id="cb16-6"><a href="suitability-mapping-part-2.html#cb16-6" tabindex="-1"></a><span class="fu">head</span>(california_fires_env, <span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb16-7"><a href="suitability-mapping-part-2.html#cb16-7" tabindex="-1"></a><span class="fu">head</span>(background_points_env, <span class="at">n=</span><span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="preparation-of-training-test-data-for-prediction-model-cross-validation" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Preparation of training &amp; test data for prediction &amp; model cross-validation<a href="suitability-mapping-part-2.html#preparation-of-training-test-data-for-prediction-model-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we need to complete one more step before we construct our wildfire risk model. We have to come up with a way to assess how well our model can actually predict whether we will likely find a trigger point for fires in a particular location. To make this assessment, we will need to perform some ‘cross-validation’ i.e., that is setting aside some of our presence-absence locations, and using them to test the model. In our case, we will randomly withhold 25% of the observations as test data, and retain the other 75% as training data for the prediction.</p>
<p>This means that we will be fitting the model multiple times, withholding each fourth of the data separately, then average the results. This is called a <strong>k-fold cross-validation</strong> (in our case 4-fold).</p>
<p>However, for our purposes of time, we will just fit the model once to demonstrate what is actually happening for you to get the gist. Ideally, we will need to perform a 4-fold cross-validation and in turn average the estimates across the values for AUC and those for the true positives and negative as described in <strong>section 5.4.2</strong>.</p>
<p>Use the <code>kfold()</code> function to split the presence data from <code>california_fires_env</code> object into 4 equal parts. This should add an index that makes four random groups of observations. You can hold 25% of the data (i.e., the first portion) by specifying <code>select == 1</code> as the test data. You can hold the remaining 75% of the data (i.e., the 2nd, 3rd and 4th portion) by specifying <code>select != 1</code> as the training data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="suitability-mapping-part-2.html#cb17-1" tabindex="-1"></a><span class="co"># set same set.seed() as before</span></span>
<span id="cb17-2"><a href="suitability-mapping-part-2.html#cb17-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20000430</span>)</span>
<span id="cb17-3"><a href="suitability-mapping-part-2.html#cb17-3" tabindex="-1"></a><span class="co"># using k-fold function to split data into 4 equal parts</span></span>
<span id="cb17-4"><a href="suitability-mapping-part-2.html#cb17-4" tabindex="-1"></a>select <span class="ot">&lt;-</span> <span class="fu">kfold</span>(california_fires_env, <span class="dv">4</span>)</span>
<span id="cb17-5"><a href="suitability-mapping-part-2.html#cb17-5" tabindex="-1"></a><span class="co"># 25% of the fire data use for testing the model</span></span>
<span id="cb17-6"><a href="suitability-mapping-part-2.html#cb17-6" tabindex="-1"></a>california_fires_env_test <span class="ot">&lt;-</span> california_fires_env[select<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb17-7"><a href="suitability-mapping-part-2.html#cb17-7" tabindex="-1"></a><span class="co"># 75% of the fire data use for training the model</span></span>
<span id="cb17-8"><a href="suitability-mapping-part-2.html#cb17-8" tabindex="-1"></a>california_fires_env_train <span class="ot">&lt;-</span> california_fires_env[select<span class="sc">!=</span><span class="dv">1</span>,]</span></code></pre></div>
<p>Repeat the above process for the background points:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="suitability-mapping-part-2.html#cb18-1" tabindex="-1"></a><span class="co"># set same set.seed() as before</span></span>
<span id="cb18-2"><a href="suitability-mapping-part-2.html#cb18-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20000430</span>)</span>
<span id="cb18-3"><a href="suitability-mapping-part-2.html#cb18-3" tabindex="-1"></a><span class="co"># repeat the process for the background points</span></span>
<span id="cb18-4"><a href="suitability-mapping-part-2.html#cb18-4" tabindex="-1"></a>select <span class="ot">&lt;-</span> <span class="fu">kfold</span>(background_points_env, <span class="dv">4</span>)</span>
<span id="cb18-5"><a href="suitability-mapping-part-2.html#cb18-5" tabindex="-1"></a>background_points_env_test <span class="ot">&lt;-</span> background_points_env[select<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb18-6"><a href="suitability-mapping-part-2.html#cb18-6" tabindex="-1"></a>background_points_env_train <span class="ot">&lt;-</span> background_points_env[select<span class="sc">!=</span><span class="dv">1</span>,]</span></code></pre></div>
<p>Now, let us row bind the training and test dataset together using the <code>rbind()</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="suitability-mapping-part-2.html#cb19-1" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(california_fires_env_train, background_points_env_train)</span>
<span id="cb19-2"><a href="suitability-mapping-part-2.html#cb19-2" tabindex="-1"></a>testing_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(california_fires_env_test, background_points_env_test)</span></code></pre></div>
<p>We are now in the position to execute the distributional niche models.</p>
</div>
</div>
<div id="maxent-analysis" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> MAXENT Analysis<a href="suitability-mapping-part-2.html#maxent-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, we can fit the niche model using the Maximum Entropy (MAXENT) algorithm, which tries to define the combination of environmental risk factors that best predicts the occurrence of the wildfires in California. The <code>maxent()</code> allows the users to implement such algorithm.</p>
<p>Here are some important notes on it’s usage:</p>
<ol style="list-style-type: decimal">
<li><code>maxent()</code>: This function uses environmental data for locations of known presence and for a large number of ‘background’ locations. It has three mandatory arguments - <code>x</code>, <code>p</code>, and <code>args</code>.</li>
<li><code>x</code>: In this argument, you must specify the columns of the predictor variables in the training data frame. The first columns in the example are the risk factors we are interested.</li>
<li><code>p</code>: In this argument, you must specify the column containing the presence and absence of fires in the training data frame.</li>
<li><code>args</code>: This allows for additional arguments.</li>
</ol>
<p>Running the <code>maxent()</code> code should look something like:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="suitability-mapping-part-2.html#cb20-1" tabindex="-1"></a>model_training <span class="ot">&lt;-</span> <span class="fu">maxent</span>(<span class="at">x=</span>training_data[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)], <span class="at">p=</span>training_data[,<span class="dv">7</span>], <span class="at">args=</span><span class="fu">c</span>(<span class="st">&quot;responsecurves&quot;</span>))</span></code></pre></div>
<div id="examination-of-the-predictors-contribution-and-response-curves" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Examination of the predictor’s contribution and response curves<a href="suitability-mapping-part-2.html#examination-of-the-predictors-contribution-and-response-curves" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The results are stored in the <code>model_training</code> object. We can examine which variable has the biggest contribution to the presence of wildfire presences in California:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="suitability-mapping-part-2.html#cb21-1" tabindex="-1"></a><span class="fu">plot</span>(model_training, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab =</span> <span class="st">&quot;Percentage [%]&quot;</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="images/general/week5/image3_variable_contribution.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="note">
<p><strong>IMPORTANT NOTES</strong>: We can view the contribution estimates for each covariate more precisely by typing in RConsole the following code: <code>model_training@results</code>. Here, we can see the following contribution estimates: NDVI (44.2321%); Elevation (23.5530%); Deprivation (12.0339%); Dryness (9.9266); Temperature (6.8892%); and Precipitation (3.3653%). The contribution estimates should sum up to 100%.</p>
<p><strong>Interpretation</strong>: From this plot, we can see that the model is most sensitive to variation in NDVI, followed with additional contributions from land surface elevation, and from increased levels of socioeconomic deprivation (reporting top three).</p>
</div>
<p>We can examine as well as the likelihood of fire occurrence and how it responds to variation in these conditions. To see the shape of the response curves estimated by the model, we can use the <code>response()</code> function:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="suitability-mapping-part-2.html#cb22-1" tabindex="-1"></a><span class="fu">response</span>(model_training)</span></code></pre></div>
<p><img src="images/general/week5/image4_responsecurves.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="note">
<p><strong>Interpretation</strong>: In the response plots, we are looking at how the probability of fire occurrence (Y-axes, from zero to one) varies with each the environmental predictors (X-axes). From these plots, we can see that the MAXENT models can include complex environmental responses including plateau, linear, and nonlinear shapes, and some which are utterly unclear. For example, if we look at mean temperature during the summer, we can see that the probability for fire occurrence peaks around 0.60 when temperatures are around 30 degrees Celsius. We can also see that the probability of such outcome increases with more and more vegetation during the summer period. Probability in terms of fires in relation to deprivation is a flat line. For precipitation, dryness and elevation - the patterns are unclear.</p>
</div>
</div>
<div id="model-validation" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Model validation<a href="suitability-mapping-part-2.html#model-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An important part is model validation - this involves assessing how well does the model actually predict the occurrence of wildfires. To evaluate the predictive accuracy of the model, we turn back to our test data i.e., <code>testing_data</code> object, and use cross-validation to test the model.</p>
<p>In our evaluation - there are two main outputs of interest:</p>
<ol style="list-style-type: decimal">
<li><code>AUC</code> (Area Under the Curve), which is a test of model performance where higher values indicate greater accuracy in our predictions. An AUC value of 0.5 is common cut-off point used for assessing model performance. Note that an AUC value of 0.5 or lower is the same as random guessing of presence/absence, while values towards one mean our predictions are more reliable and accurate.</li>
<li><code>max TPR+TNR</code>, which denotes the probability threshold at which our model maximizes the True Positive Rate and the True Negative Rate. It is generally accepted that this is an optimum value at which to set the threshold for binary classification of the predicted probabilities in our mapping outputs. Anything above value is deemed as a region environmentally suitable for outcome.</li>
</ol>
<p>We use the <code>evaluate()</code> function to perform cross-validation analysis.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="suitability-mapping-part-2.html#cb23-1" tabindex="-1"></a><span class="co"># model evaluation use the test data on the trained model for validation</span></span>
<span id="cb23-2"><a href="suitability-mapping-part-2.html#cb23-2" tabindex="-1"></a>cross_validation <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(<span class="at">p=</span>testing_data[testing_data<span class="sc">$</span>fire<span class="sc">==</span><span class="dv">1</span>,], <span class="at">a=</span>testing_data[testing_data<span class="sc">$</span>fire<span class="sc">==</span><span class="dv">0</span>,], <span class="at">model =</span> model_training)</span></code></pre></div>
<p>Here are some important notes on it’s usage:</p>
<ol style="list-style-type: decimal">
<li><code>evaluate()</code>: This function used for model evaluation and validation. It has the following arguments - <code>p</code>, <code>a</code>, and <code>model</code>.</li>
<li><code>p</code>: In this argument, you must specify the column of outcome and filter on the presence value e.g., <code>testing_data[testing_data$fire==1,]</code>.</li>
<li><code>a</code>: In this argument, you must specify the column of outcome and filter on the absence value e.g., <code>testing_data[testing_data$fire==0,]</code></li>
<li><code>model</code>: Specify the full training model object e.g., <code>model_training</code>.</li>
</ol>
<p>Now call results and plot AUC curve:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="suitability-mapping-part-2.html#cb24-1" tabindex="-1"></a>cross_validation </span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="suitability-mapping-part-2.html#cb25-1" tabindex="-1"></a><span class="sc">&gt;</span> cross_validation</span>
<span id="cb25-2"><a href="suitability-mapping-part-2.html#cb25-2" tabindex="-1"></a>class          <span class="sc">:</span> ModelEvaluation </span>
<span id="cb25-3"><a href="suitability-mapping-part-2.html#cb25-3" tabindex="-1"></a>n presences    <span class="sc">:</span> <span class="dv">14120</span> </span>
<span id="cb25-4"><a href="suitability-mapping-part-2.html#cb25-4" tabindex="-1"></a>n absences     <span class="sc">:</span> <span class="dv">27609</span> </span>
<span id="cb25-5"><a href="suitability-mapping-part-2.html#cb25-5" tabindex="-1"></a>AUC            <span class="sc">:</span> <span class="fl">0.9074081</span> </span>
<span id="cb25-6"><a href="suitability-mapping-part-2.html#cb25-6" tabindex="-1"></a>cor            <span class="sc">:</span> <span class="fl">0.7003824</span> </span>
<span id="cb25-7"><a href="suitability-mapping-part-2.html#cb25-7" tabindex="-1"></a>max TPR<span class="sc">+</span>TNR at <span class="sc">:</span> <span class="fl">0.4054474</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="suitability-mapping-part-2.html#cb26-1" tabindex="-1"></a><span class="fu">plot</span>(cross_validation, <span class="st">&#39;ROC&#39;</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="images/general/week5/image5_auc_curve.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="note">
<p><strong>Interpretation</strong>: On the receiver operator curve, the 1:1 line give an AUC of 0.5. From our curve and the AUC, it is clear that our model appears to do substantially better than random guessing (high AUC value = 0.907 [90.7%]). The optimal probability threshold at which our model maximizes the True Positive Rate and the True Negative Rate is 0.4054474 (40.55%). Hence, we will use predicted probability &gt; 0.4054 to delineate areas of suitability (or trigger points) for wildfires.</p>
</div>
</div>
<div id="mapping-the-predicted-probability-and-suitability" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Mapping the predicted probability and suitability<a href="suitability-mapping-part-2.html#mapping-the-predicted-probability-and-suitability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To map the predicted probabilities use the <code>predict()</code> function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="suitability-mapping-part-2.html#cb27-1" tabindex="-1"></a>prob_wildfire <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_training, envCovariates)</span></code></pre></div>
<p>Generate a predicted probability map from above <code>prob_wildfire</code> object:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="suitability-mapping-part-2.html#cb28-1" tabindex="-1"></a><span class="co"># generate a publication-worthy figure</span></span>
<span id="cb28-2"><a href="suitability-mapping-part-2.html#cb28-2" tabindex="-1"></a><span class="co"># map of probability </span></span>
<span id="cb28-3"><a href="suitability-mapping-part-2.html#cb28-3" tabindex="-1"></a><span class="fu">tm_shape</span>(prob_wildfire) <span class="sc">+</span></span>
<span id="cb28-4"><a href="suitability-mapping-part-2.html#cb28-4" tabindex="-1"></a>    <span class="fu">tm_raster</span>(<span class="at">title =</span> <span class="st">&quot;Predicted probability&quot;</span>, <span class="at">palette =</span> <span class="st">&#39;-RdYlBu&#39;</span>, <span class="at">style =</span><span class="st">&#39;cont&#39;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>))<span class="sc">+</span></span>
<span id="cb28-5"><a href="suitability-mapping-part-2.html#cb28-5" tabindex="-1"></a><span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="suitability-mapping-part-2.html#cb28-6" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">&quot;Predicted Probability of Wild Fire [%]&quot;</span>, <span class="at">main.title.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>), <span class="at">title.size=</span><span class="dv">3</span>, <span class="at">legend.text.size =</span> <span class="fl">1.1</span>, </span>
<span id="cb28-7"><a href="suitability-mapping-part-2.html#cb28-7" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.65</span>, <span class="fl">0.55</span>), <span class="at">legend.height=</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">legend.title.size =</span> <span class="fl">1.1</span>, <span class="at">frame=</span><span class="st">&#39;white&#39;</span>)<span class="sc">+</span></span>
<span id="cb28-8"><a href="suitability-mapping-part-2.html#cb28-8" tabindex="-1"></a>    <span class="fu">tm_scale_bar</span>(<span class="at">position=</span><span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.02</span>), <span class="at">text.size =</span> <span class="dv">1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb28-9"><a href="suitability-mapping-part-2.html#cb28-9" tabindex="-1"></a>    <span class="fu">tm_compass</span>(<span class="at">north =</span> <span class="dv">0</span>,<span class="at">type =</span> <span class="st">&#39;arrow&#39;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&#39;right&#39;</span>, <span class="st">&#39;top&#39;</span>), <span class="at">text.size =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="images/general/week5/Image6_predicted_prob.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Extract the optimal threshold value from cross validation object <code>cross_validation</code> using the <code>threshold()</code> function and use it to reclassify the raster object i.e., <code>prob_wildfire</code> to a binary raster. Recall, the value was <code>0.4054474</code>. A probability estimate less than <code>0.4054474</code> is classed as <code>0</code> and anything above as <code>1</code>. The predicted probability &gt; 0.4054 are the areas in California suitable (or expected trigger points) for wildfires.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="suitability-mapping-part-2.html#cb29-1" tabindex="-1"></a><span class="co"># calculate thresholds of models</span></span>
<span id="cb29-2"><a href="suitability-mapping-part-2.html#cb29-2" tabindex="-1"></a>threshold_value <span class="ot">&lt;-</span> <span class="fu">threshold</span>(cross_validation, <span class="st">&quot;spec_sens&quot;</span>)</span>
<span id="cb29-3"><a href="suitability-mapping-part-2.html#cb29-3" tabindex="-1"></a><span class="co"># report value</span></span>
<span id="cb29-4"><a href="suitability-mapping-part-2.html#cb29-4" tabindex="-1"></a>threshold_value</span></code></pre></div>
<p>Reclassifying raster object <code>prob_wildfire</code> with threshold value:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="suitability-mapping-part-2.html#cb30-1" tabindex="-1"></a><span class="co"># prepare threshold total map </span></span>
<span id="cb30-2"><a href="suitability-mapping-part-2.html#cb30-2" tabindex="-1"></a>create_classes_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, threshold_value, <span class="dv">0</span>, threshold_value, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb30-3"><a href="suitability-mapping-part-2.html#cb30-3" tabindex="-1"></a>create_clasess_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(create_classes_vector, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-4"><a href="suitability-mapping-part-2.html#cb30-4" tabindex="-1"></a>create_clasess_matrix</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="suitability-mapping-part-2.html#cb31-1" tabindex="-1"></a><span class="sc">&gt;</span> create_clasess_matrix</span>
<span id="cb31-2"><a href="suitability-mapping-part-2.html#cb31-2" tabindex="-1"></a>          [,<span class="dv">1</span>]      [,<span class="dv">2</span>] [,<span class="dv">3</span>]</span>
<span id="cb31-3"><a href="suitability-mapping-part-2.html#cb31-3" tabindex="-1"></a>[<span class="dv">1</span>,] <span class="fl">0.0000000</span> <span class="fl">0.4054474</span>    <span class="dv">0</span></span>
<span id="cb31-4"><a href="suitability-mapping-part-2.html#cb31-4" tabindex="-1"></a>[<span class="dv">2</span>,] <span class="fl">0.4054474</span> <span class="fl">1.0000000</span>    <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="suitability-mapping-part-2.html#cb32-1" tabindex="-1"></a><span class="co"># create new reclassify raster based on prob_wildfires</span></span>
<span id="cb32-2"><a href="suitability-mapping-part-2.html#cb32-2" tabindex="-1"></a>suitability_wildfires <span class="ot">&lt;-</span> <span class="fu">reclassify</span>(prob_wildfire, create_clasess_matrix)</span></code></pre></div>
<p>Generate final output which shows regions as trigger points:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="suitability-mapping-part-2.html#cb33-1" tabindex="-1"></a><span class="fu">tm_shape</span>(suitability_wildfires) <span class="sc">+</span> <span class="fu">tm_raster</span>(<span class="at">style =</span> <span class="st">&quot;cat&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Threshold&quot;</span>, <span class="at">palette=</span> <span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Safe&quot;</span>, <span class="st">&quot;Trigger Points&quot;</span>)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="suitability-mapping-part-2.html#cb33-2" tabindex="-1"></a>    <span class="fu">tm_shape</span>(california_county) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">border.col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="suitability-mapping-part-2.html#cb33-3" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="images/general/week5/Image7_suitability.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="supplementary-code-for-4-fold-analysis" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Supplementary code for 4-fold analysis<a href="suitability-mapping-part-2.html#supplementary-code-for-4-fold-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details>
<summary>
<strong>Click here to see code:</strong>
</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="suitability-mapping-part-2.html#cb34-1" tabindex="-1"></a><span class="co"># split plot panel into 4 segments for 4 AUC plots</span></span>
<span id="cb34-2"><a href="suitability-mapping-part-2.html#cb34-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb34-3"><a href="suitability-mapping-part-2.html#cb34-3" tabindex="-1"></a><span class="co"># create a list() object to dump results inside `eMAX`</span></span>
<span id="cb34-4"><a href="suitability-mapping-part-2.html#cb34-4" tabindex="-1"></a>eMAX<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb34-5"><a href="suitability-mapping-part-2.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="suitability-mapping-part-2.html#cb34-6" tabindex="-1"></a><span class="co"># use california_fires_env</span></span>
<span id="cb34-7"><a href="suitability-mapping-part-2.html#cb34-7" tabindex="-1"></a><span class="co"># use background_points_env</span></span>
<span id="cb34-8"><a href="suitability-mapping-part-2.html#cb34-8" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb34-9"><a href="suitability-mapping-part-2.html#cb34-9" tabindex="-1"></a></span>
<span id="cb34-10"><a href="suitability-mapping-part-2.html#cb34-10" tabindex="-1"></a>kfold_pres <span class="ot">&lt;-</span> <span class="fu">kfold</span>(california_fires_env, folds)</span>
<span id="cb34-11"><a href="suitability-mapping-part-2.html#cb34-11" tabindex="-1"></a>kfold_back <span class="ot">&lt;-</span> <span class="fu">kfold</span>(background_points_env, folds)</span>
<span id="cb34-12"><a href="suitability-mapping-part-2.html#cb34-12" tabindex="-1"></a></span>
<span id="cb34-13"><a href="suitability-mapping-part-2.html#cb34-13" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20000430</span>)</span>
<span id="cb34-14"><a href="suitability-mapping-part-2.html#cb34-14" tabindex="-1"></a><span class="co"># adapting loop code from https://rpubs.com/mlibxmda/GEOG70922_Week5</span></span>
<span id="cb34-15"><a href="suitability-mapping-part-2.html#cb34-15" tabindex="-1"></a><span class="co"># takes a long time to run 4-fold</span></span>
<span id="cb34-16"><a href="suitability-mapping-part-2.html#cb34-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>folds) {</span>
<span id="cb34-17"><a href="suitability-mapping-part-2.html#cb34-17" tabindex="-1"></a>    train <span class="ot">&lt;-</span> california_fires_env[kfold_pres<span class="sc">!=</span> i,]</span>
<span id="cb34-18"><a href="suitability-mapping-part-2.html#cb34-18" tabindex="-1"></a>    test <span class="ot">&lt;-</span> california_fires_env[kfold_pres <span class="sc">==</span> i,]</span>
<span id="cb34-19"><a href="suitability-mapping-part-2.html#cb34-19" tabindex="-1"></a>    backTrain<span class="ot">&lt;-</span>background_points_env[kfold_back<span class="sc">!=</span>i,]</span>
<span id="cb34-20"><a href="suitability-mapping-part-2.html#cb34-20" tabindex="-1"></a>    backTest<span class="ot">&lt;-</span>background_points_env[kfold_back<span class="sc">==</span>i,]</span>
<span id="cb34-21"><a href="suitability-mapping-part-2.html#cb34-21" tabindex="-1"></a>    dataTrain<span class="ot">&lt;-</span><span class="fu">rbind</span>(train,backTrain)</span>
<span id="cb34-22"><a href="suitability-mapping-part-2.html#cb34-22" tabindex="-1"></a>    dataTest<span class="ot">&lt;-</span><span class="fu">rbind</span>(test,backTest)</span>
<span id="cb34-23"><a href="suitability-mapping-part-2.html#cb34-23" tabindex="-1"></a>    maxnet_eval <span class="ot">&lt;-</span> <span class="fu">maxent</span>(<span class="at">x=</span>dataTrain[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)], <span class="at">p=</span>dataTrain[,<span class="dv">7</span>], <span class="at">args=</span><span class="fu">c</span>(<span class="st">&quot;responsecurves&quot;</span>))</span>
<span id="cb34-24"><a href="suitability-mapping-part-2.html#cb34-24" tabindex="-1"></a>    eMAX[[i]] <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(<span class="at">p=</span>dataTest[dataTest<span class="sc">$</span>fire<span class="sc">==</span><span class="dv">1</span>,],<span class="at">a=</span>dataTest[dataTest<span class="sc">$</span>fire<span class="sc">==</span><span class="dv">0</span>,], maxnet_eval)</span>
<span id="cb34-25"><a href="suitability-mapping-part-2.html#cb34-25" tabindex="-1"></a>    <span class="fu">plot</span>(eMAX[[i]],<span class="st">&#39;ROC&#39;</span>)</span>
<span id="cb34-26"><a href="suitability-mapping-part-2.html#cb34-26" tabindex="-1"></a>}</span>
<span id="cb34-27"><a href="suitability-mapping-part-2.html#cb34-27" tabindex="-1"></a></span>
<span id="cb34-28"><a href="suitability-mapping-part-2.html#cb34-28" tabindex="-1"></a>aucMAX <span class="ot">&lt;-</span> <span class="fu">sapply</span>( eMAX, <span class="cf">function</span>(x){<span class="fu">slot</span>(x, <span class="st">&#39;auc&#39;</span>)} )</span>
<span id="cb34-29"><a href="suitability-mapping-part-2.html#cb34-29" tabindex="-1"></a><span class="co"># report 4 of the AUC</span></span>
<span id="cb34-30"><a href="suitability-mapping-part-2.html#cb34-30" tabindex="-1"></a>aucMAX</span>
<span id="cb34-31"><a href="suitability-mapping-part-2.html#cb34-31" tabindex="-1"></a><span class="co"># find the mean of AUC (and it must be &gt; 0.50)</span></span>
<span id="cb34-32"><a href="suitability-mapping-part-2.html#cb34-32" tabindex="-1"></a><span class="fu">mean</span>(aucMAX)</span>
<span id="cb34-33"><a href="suitability-mapping-part-2.html#cb34-33" tabindex="-1"></a></span>
<span id="cb34-34"><a href="suitability-mapping-part-2.html#cb34-34" tabindex="-1"></a><span class="co">#Get maxTPR+TNR for the maxnet model</span></span>
<span id="cb34-35"><a href="suitability-mapping-part-2.html#cb34-35" tabindex="-1"></a>Opt_MAX<span class="ot">&lt;-</span><span class="fu">sapply</span>( eMAX, <span class="cf">function</span>(x){ x<span class="sc">@</span>t[<span class="fu">which.max</span>(x<span class="sc">@</span>TPR <span class="sc">+</span> x<span class="sc">@</span>TNR)] } )</span>
<span id="cb34-36"><a href="suitability-mapping-part-2.html#cb34-36" tabindex="-1"></a>Opt_MAX</span>
<span id="cb34-37"><a href="suitability-mapping-part-2.html#cb34-37" tabindex="-1"></a></span>
<span id="cb34-38"><a href="suitability-mapping-part-2.html#cb34-38" tabindex="-1"></a>Mean_OptMAX<span class="ot">&lt;-</span><span class="fu">mean</span>(Opt_MAX)</span>
<span id="cb34-39"><a href="suitability-mapping-part-2.html#cb34-39" tabindex="-1"></a>Mean_OptMAX</span>
<span id="cb34-40"><a href="suitability-mapping-part-2.html#cb34-40" tabindex="-1"></a><span class="co"># use Mean_OptMAX as threshold for mapping suitability</span></span>
<span id="cb34-41"><a href="suitability-mapping-part-2.html#cb34-41" tabindex="-1"></a></span>
<span id="cb34-42"><a href="suitability-mapping-part-2.html#cb34-42" tabindex="-1"></a><span class="co">#Note: that final results is AUC: 0.9059569; threshold: 0.4338418</span></span></code></pre></div>
</details>
</div>
</div>
<div id="attributions" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Attributions<a href="suitability-mapping-part-2.html#attributions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This week’s practical uses content and inspiration from:</p>
<p>Taylor, L. 2022. The social side of fire: assessing the inclusion of human social factors in fire prediction models (submitted as a dissertation [for degree in MSc Social &amp; Geographic Data Science] at UCL). <a href="https://github.com/lucyadtaylor/Dissertation-code-and-data"><strong>Source</strong></a></p>
</div>
<div id="references-see-reading-list" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> References (see reading list)<a href="suitability-mapping-part-2.html#references-see-reading-list" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><strong>Book</strong>: [R Programming] Dorman, M. (2014) Learning R for Geospatial Analysis; <strong>Chapter 3: Working with Rasters</strong> <a href="https://drive.google.com/file/d/1zkin0SY2bQFUGGZtBwXqSBoR8I2m-8SR/view?usp=sharing"><strong>Click link</strong></a> (Note: <strong>Downloadable</strong>)</li>
<li><strong>Book</strong>: [Theory] Stockwell, D. (2019) Niche Modeling: Predictions from Statistical Distributions; <strong>Chapter 4: Topology</strong>; CRC Press; pages: 45-63.</li>
<li><strong>Online</strong>: [Tutorials] Hijmans, R.J., &amp; Elith, J. (2021) <strong>Species distribution modelling</strong> <a href="https://rspatial.org/raster/sdm/1_sdm_introduction.html"><strong>Click link</strong></a></li>
<li><strong>Online</strong>: [Tutorials] Kerkhoff, D. (2016) <strong>Ecological Responses to Climate Change: Species Distribution Modelling using Maxent</strong> <a href="https://rstudio-pubs-static.s3.amazonaws.com/224303_df34f170cd9144cda6477ae8232887f7.html"><strong>Click link</strong></a></li>
<li><strong>Online</strong>: [Tutorials] Dennis, M. (2020) <strong>Practical 4: Species Distribution Modelling I</strong> <a href="https://rpubs.com/mlibxmda/GEOG70922_Week5"><strong>Click link</strong></a></li>
<li><strong>Paper</strong>: [Application] Escobar, L.E., (2020). Ecological Niche Modeling: An Introduction for Veterinarians and Epidemiologists, Frontiers in Veterinary Science <a href="https://www.frontiersin.org/articles/10.3389/fvets.2020.519059/full"><strong>Click link</strong></a></li>
<li><strong>Paper</strong>: [Application] Banks, W.E., (2017). The application of ecological niche modeling methods to archaeological data in order to examine culture-environment relationships and cultural trajectories; Quarternaire <a href="https://journals.openedition.org/quaternaire/7966"><strong>Click link</strong></a></li>
<li><strong>Paper</strong>: [Application] Liao, Y., Lei, Y., Ren, Z., Chen, H., &amp; Li., D., (2017). Predicting the potential risk area of illegal vaccine trade in China; Scientific Reports, Issue 7, 3883. <a href="https://www.nature.com/articles/s41598-017-03512-3"><strong>Click link</strong></a></li>
</ol>
</div>
<div id="data-sources" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Data Sources<a href="suitability-mapping-part-2.html#data-sources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>All shape files [Source: <strong>California Open Data Portal</strong>] <a href="https://data.ca.gov/dataset/ca-geographic-boundaries"><strong>Click Here</strong></a></li>
<li>Global Wildfires detection points [Source: <strong>Fire Information Resource Management System</strong>] <a href="https://firms.modaps.eosdis.nasa.gov"><strong>Click Here</strong></a></li>
<li>Environmental data for temperature &amp; precipitation [Source: <strong>WorldClim</strong>] <a href="https://www.worldclim.org"><strong>Click Here</strong></a></li>
<li>Socioeconomic vulnerability index (requires user login) [Source: <strong>Socioeconomic Data and Applications Center (SEDAC)</strong>] <a href="https://sedac.ciesin.columbia.edu"><strong>Click Here</strong></a></li>
<li>Digital Elevation Model [Source: <strong>SRTM 90m DEM Digital Elevation Database</strong>] <a href="https://srtm.csi.cgiar.org"><strong>Click Here</strong></a></li>
<li>Evapotranspiration (aridity) 1.0km [Source: <strong>NASA MODIS MOD16A2</strong>] <a href="https://modis.gsfc.nasa.gov/data/dataprod/mod16.php"><strong>Click Here</strong></a></li>
<li>Normalised Differenced Vegetation Index (NDVI) 250m [Source: <strong>NASA MODIS MOD13Q1</strong>] <a href="https://modis.gsfc.nasa.gov/data/dataprod/mod13.php"><strong>Click Here</strong></a></li>
</ol>
</div>
<div id="practical-homework" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Practical homework<a href="suitability-mapping-part-2.html#practical-homework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Suitability mapping of the Aedes mosquito and infestation in Brazil</strong></p>
<p>Many regions in Brazil were hit hard by the Zika virus infection outbreak in 2015. Zika infection is caused by the arboviruses transmitted by the Aedes mosquitoes which are abundant in Brazil. It is a known fact that increased abundance of the Aedes mosquito is typically associated with standing (or stagnant) water which serves as a reservoir or hotspot for breeding. Apart from the presence of standing (or stagnated) water in human dwellings, it is important to consider other intermediate factors that drive the mosquitoes to increase in population size. These factors are the following:</p>
<ul>
<li>Temperature</li>
<li>Precipitation</li>
<li>Population Density</li>
<li>NDVI</li>
<li>Land surface elevation</li>
<li>Natural lighting</li>
<li>Urban-rural classification</li>
</ul>
<p>The above listed variables are gridded datasets which can be downloaded by clicking <a href="https://github.com/UCLPG-MSC-SGDS/Data-Sources/raw/main/Gridded%20datasets.zip"><strong>[HERE]</strong></a>. Create a map which should the following: 1.) The predicted probability of infestation of the Aedes mosquito in Brazil; and 2.) the suitability map based on the <code>max TPR + TNR</code> threshold to illustrate where the Aedes mosquito will thrive in Brazil.</p>
<p>All identified points for mosquito breeding including background points can downloaded from <a href="https://github.com/UCLPG-MSC-SGDS/Data-Sources/raw/main/Points.zip"><strong>[HERE]</strong></a>. The boundaries for Brazil can be downloaded from <a href="https://github.com/UCLPG-MSC-SGDS/Data-Sources/raw/main/Shapefiles.zip"><strong>[HERE]</strong></a>.</p>
<p>The expected output should look like:</p>
<p><img src="images/general/week5/image8_FinalPicture.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Notes:</strong></p>
<ul>
<li>For the predicted probability map (A), reclassify the predictions to the following categories - <code>0-0.2</code>, <code>0.2-0.4</code>, <code>0.4-0.6</code>, <code>0.6-0.8</code> and <code>0.8-1.0</code>.</li>
<li>For the second suitability map (B), reclassify the probabilities based on the <code>max TPR + TNR</code> threshold i.e., below it as <code>0</code> and labelled as ‘None infested areas’ and above as <code>1</code> labelled as ‘Infested areas’.</li>
</ul>
<p>This week’s homework practical was based on the original research paper:</p>
<ul>
<li>Musah <em>et al</em> (2023). Coalescing disparate data sources for the geospatial prediction of mosquito abundance, using Brazil as a motivating case study. <strong>Frontiers in Tropical Diseases</strong>. Volume 4. DOI: <a href="https://doi.org/10.3389/fitd.2023.1039735" class="uri">https://doi.org/10.3389/fitd.2023.1039735</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation-of-r-and-rstudio.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": true
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/UCLPG-MSC-SGDS/IRDR0047/edit/main/01-Suitability_mapping_ecological_niche_models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
